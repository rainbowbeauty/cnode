/**
 * LBS mSlideIMG 循环版-自动 (复制节点方式)
 * Date: 2014-5-11
 * ===================================================
 * opts.mslide 	外围容器/滑动事件对象(一个CSS选择器)
 * opts.mcontent  内容容器/滑动切换对象(一个CSS选择器) 
 * opts.index 	索引(默认0) 指定显示哪个索引的标题、内容
 * opts.navclass  导航容器的类名(默认mnav)
 * opts.current  当前项的类名(默认current)
 * opts.auto	是否自动播放 默认false
 * opts.delay	自动播放间隔时间 默认5秒 自动播放时有效
 * opts.duration	动画持续时间 默认400ms
 * ===================================================
**/
(function(){window.mSlideIMG=function(a){void 0!==typeof a&&(this.mslide=document.querySelector(a.mslide),this.mcontent=document.querySelector(a.mcontent),this.mcontents=this.mcontent.children,this.mnav=null,this.mnavs=[],this.length=this.mcontents.length,1>this.length||(a.index>this.length-1&&(a.index=this.length-1),this.index=this.oIndex=this.nIndex=a.index||0,this.current=a.current||"current",this.navclass=a.navclass||"mnav",this.duration=a.duration||400,(this.auto=!!a.auto||!1)&&(this.delay=a.delay||
5),this.timer=null,this.touch={},this.init()))};mSlideIMG.prototype={init:function(a){this.set();this.initset();this.bind()},initset:function(){this.create();1<this.length&&(this.mcontent.appendChild(this.mcontents[0].cloneNode(!0)),this.mcontent.appendChild(this.mcontents[1].cloneNode(!0)));for(var a=0;a<this.length+2;a++)this.mcontents[a]&&("absolute"===getComputedStyle(this.mcontents[a],null).position&&(this.mcontents[a].style.position="relative"),"left"!==getComputedStyle(this.mcontents[a],null).cssFloat&&
(this.mcontents[a].style.cssFloat="left"));this.mnavs[this.index].className=this.current;this.mcontents[this.index].className+=" "+this.current;this.mcontent.style.webkitTransform=this.mcontent.style.transform="translate3d("+-this.index*this.width+"px,0,0)"},set:function(){this.width=document.documentElement.clientWidth||document.body.clientWidth;this.mcontent.style.width=(this.length+2)*this.width+"px";for(var a=0;a<this.length+2;a++)this.mcontents[a]&&(this.mcontents[a].style.width=this.width+"px");
this.mcontent.style.webkitTransform=this.mcontent.style.transform="translate3d("+-this.index*this.width+"px,0,0)"},create:function(){this.mnav=document.createElement("ul");li=null;for(i=0;i<this.length;i++)li=document.createElement("li"),li.innerHTML=i+1,this.mnavs.push(li),this.mnav.appendChild(li);this.mnav.className=this.navclass;this.mslide.appendChild(this.mnav)},bind:function(){var a=this;this.mslide.addEventListener("touchstart",function(b){a.touchStart(b);a.auto&&a.stop()},!1);this.mslide.addEventListener("touchmove",
function(b){a.touchMove(b);a.auto&&a.stop()},!1);this.mslide.addEventListener("touchend",function(b){a.touchEnd(b);a.auto&&a.start()},!1);this.mslide.addEventListener("touchcancel",function(b){a.touchEnd(b);a.auto&&a.start()},!1);this.mcontent.addEventListener("webkitTransitionEnd",function(){a.transitionEnd()},!1);window.addEventListener("resize",function(){setTimeout(function(){a.set()},100)},!1);window.addEventListener("orientationchange",function(){setTimeout(function(){a.set()},100)},!1);this.auto&&
this.start()},touchStart:function(a){this.touch.x=a.touches[0].pageX;this.touch.y=a.touches[0].pageY;this.touch.time=Date.now();this.touch.disX=0;this.touch.disY=0;this.touch.fixed="";this.mcontent.style.webkitTransition=this.mcontent.style.transition="all 0ms"},touchMove:function(a){2>this.length||"up"===this.touch.fixed||(a.stopPropagation(),1<a.touches.length||a.scale&&1!==a.scale||(this.touch.disX=a.touches[0].pageX-this.touch.x,this.touch.disY=a.touches[0].pageY-this.touch.y,""===this.touch.fixed&&
(Math.abs(this.touch.disY)>Math.abs(this.touch.disX)?this.touch.fixed="up":this.touch.fixed="left"),"left"===this.touch.fixed&&(a.preventDefault(),0<this.touch.disX&&0===this.index&&(this.index=this.length),0>this.touch.disX&&this.index===this.length+1&&(this.index=1),this.mcontent.style.webkitTransform=this.mcontent.style.transform="translate3d("+(this.touch.disX-this.index*this.width)+"px,0,0)")))},touchEnd:function(a){if(!(2>this.length)&&"left"===this.touch.fixed){a=Math.abs(this.touch.disX);
if(100<Date.now()-this.touch.time&&10<a||a>this.width/2)this.touch.time=Date.now(),0<this.touch.disX?this.index--:this.index++,this.index!==this.oIndex&&this.replace();this.mcontent.style.webkitTransition=this.mcontent.style.transition="all "+this.duration+"ms";this.mcontent.style.webkitTransform=this.mcontent.style.transform="translate3d("+-this.index*this.width+"px,0,0)"}},transitionEnd:function(){this.mcontent.style.webkitTransition=this.mcontent.style.transition="all 0ms";this.index===this.length+
1&&(this.index=1,this.mcontent.style.webkitTransform=this.mcontent.style.transform="translate3d("+-this.index*this.width+"px,0,0)");0===this.index&&(this.index=this.length,this.mcontent.style.webkitTransform=this.mcontent.style.transform="translate3d("+-this.index*this.width+"px,0,0)")},replace:function(){var a=this.index;a===this.length&&(a=0);a===this.length+1&&(a=1);this.mnavs[a].className=this.current;this.mnavs[this.oIndex].className="";this.mcontents[this.index].className+=" "+this.current;
this.mcontents[this.nIndex].className=this.mcontents[this.nIndex].className.replace(this.current,"").trim();this.oIndex=a;this.nIndex=this.index},start:function(){if(!(2>this.length)){var a=this;this.timer=setInterval(function(){a.index===a.length+1&&(a.index=1,a.mcontent.style.webkitTransition=a.mcontent.style.transition="all 0ms",a.mcontent.style.webkitTransform=a.mcontent.style.transform="translate3d("+-a.index*a.width+"px,0,0)");a.index++;a.index!==a.oIndex&&a.replace();a.mcontent.style.webkitTransition=
a.mcontent.style.transition="all "+a.duration+"ms";a.mcontent.style.webkitTransform=a.mcontent.style.transform="translate3d("+-a.index*a.width+"px,0,0)"},1E3*this.delay)}},stop:function(){clearInterval(this.timer);this.timer=null}}})();